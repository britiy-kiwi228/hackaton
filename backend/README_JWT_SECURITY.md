# JWT Security Improvements

## Что было улучшено

### 1. Криптографически стойкий JWT секрет
- Заменен статический небезопасный секрет на криптографически стойкий
- Используется 512-битная энтропия (64 байта случайных данных)
- Секрет кодируется в base64 для удобства использования

### 2. Валидация безопасности
Добавлена комплексная валидация JWT секрета в `app/core/config.py`:
- **Минимальная длина**: не менее 32 символов
- **Проверка небезопасных паттернов**: отклоняет секреты с типичными небезопасными фразами
- **Проверка энтропии**: для base64 секретов проверяется минимум 256 бит энтропии
- **Разнообразие символов**: для не-base64 секретов проверяется минимум 16 уникальных символов

### 3. Генератор секретов
Создан скрипт `generate_secret.py` для генерации новых криптографически стойких секретов:
```bash
python generate_secret.py
```

### 4. Обновленная конфигурация
- Обновлен `app/core/config.py` с новым безопасным секретом
- Обновлен `.env.example` с инструкциями по генерации секрета
- Миграция на Pydantic V2 (field_validator вместо validator)

### 5. Тестирование
Созданы тесты для проверки:
- `test_config.py` - базовая проверка конфигурации
- `test_jwt_validation.py` - проверка валидации секретов

## Безопасность

### Текущий секрет
- **Длина**: 88 символов (base64)
- **Энтропия**: 512 бит
- **Формат**: Base64-кодированные случайные байты

### Рекомендации для продакшена
1. Используйте переменную окружения `JWT_SECRET_KEY` в `.env` файле
2. Генерируйте новый секрет для каждого окружения
3. Никогда не коммитьте реальные секреты в репозиторий
4. Регулярно ротируйте секреты

### Генерация нового секрета
```bash
# Генерация нового секрета
python generate_secret.py

# Или через Python
python -c "import secrets, base64; print(base64.b64encode(secrets.token_bytes(64)).decode())"
```

## Проверка безопасности

Запустите тесты для проверки конфигурации:
```bash
python test_config.py
python test_jwt_validation.py
```

## Совместимость

Изменения полностью обратно совместимы:
- Существующие JWT токены остаются валидными
- API не изменился
- Только улучшена безопасность конфигурации